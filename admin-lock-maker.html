<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Admin | Lock Generator</title>
    
    <!-- Favicon -->
    <link rel="icon" href="https://aiartisan.hqaim.com/images/favicon.ico" type="image/x-icon" />

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        'deep-space': '#050507',
                        'panel-bg': '#0f1016',
                        'glass-border': 'rgba(255, 255, 255, 0.08)',
                        gold: '#d4af37',
                        'gold-dim': '#aa8c2c',
                    },
                    fontFamily: {
                        sans: ['Outfit', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    }
                }
            }
        }
    </script>
    <style>
        body { transition: background-color 0.5s ease, color 0.5s ease; }
        
        /* Dark Mode Styles */
        .dark .glass-panel {
            background: rgba(15, 16, 22, 0.6);
            backdrop-filter: blur(16px);
            border: 1px solid var(--glass-border);
        }
        .dark .input-group {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
        }
        .dark .input-group:focus-within {
            border-color: #d4af37;
            background: rgba(255, 255, 255, 0.05);
        }

        /* Light Mode Styles */
        .light .glass-panel {
            background: white;
            border: 1px solid #e5e7eb;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.15);
        }
        .light .input-group {
            background: #f9fafb;
            border: 1px solid #d1d5db;
            color: #1f2937;
        }
        .light .input-group:focus-within {
            border-color: #d4af37;
            box-shadow: 0 0 0 2px rgba(212, 175, 55, 0.1);
            background: white;
        }
        
        /* Background Blobs - Only visible in Dark Mode */
        .dark .bg-blob { opacity: 1; }
        .light .bg-blob { opacity: 0; }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center bg-gray-100 dark:bg-deep-space font-sans p-4 py-10 overflow-x-hidden relative transition-colors duration-500">

    <!-- Ambient Background (Dark Mode Only) -->
    <div class="fixed top-[-20%] left-[-10%] w-[50%] h-[50%] rounded-full bg-blue-900/10 blur-[120px] pointer-events-none bg-blob transition-opacity duration-500"></div>
    <div class="fixed bottom-[-20%] right-[-10%] w-[50%] h-[50%] rounded-full bg-gold/5 blur-[120px] pointer-events-none bg-blob transition-opacity duration-500"></div>

    <div class="max-w-3xl w-full flex flex-col gap-8 relative z-10">
        
        <!-- 1. Main Generator Panel -->
        <div class="glass-panel rounded-2xl overflow-hidden flex flex-col transition-all duration-500">
            <!-- Header -->
            <div class="p-8 border-b border-gray-200 dark:border-white/5 bg-white dark:bg-white/5 flex justify-between items-center transition-colors duration-500">
                <!-- Title & Status -->
                <div>
                    <h1 class="text-2xl font-bold text-gray-900 dark:text-white tracking-tight flex items-center gap-3 font-mono transition-colors duration-500">
                        <i class="fa-solid fa-shield-halved text-gold"></i> 
                        LOCK_MAKER_V2.1
                        <!-- Status Dot -->
                        <span class="relative flex h-2 w-2">
                          <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
                          <span class="relative inline-flex rounded-full h-2 w-2 bg-green-500"></span>
                        </span>
                    </h1>
                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1 font-mono transition-colors duration-500">AES-GCM-256 Encryption Engine</p>
                </div>
                
                <!-- Theme Toggle -->
                <button onclick="toggleTheme()" class="w-10 h-10 rounded-full bg-gray-100 dark:bg-white/10 flex items-center justify-center hover:bg-gray-200 dark:hover:bg-white/20 transition-all duration-300 shadow-sm group" title="Toggle Theme">
                    <!-- Light Theme Icon: Golden Sun with Sparkle -->
                    <i class="fa-solid fa-sun text-lg text-yellow-500 block dark:hidden filter drop-shadow-sm group-hover:text-yellow-400 transition-colors"></i>
                    <!-- Dark Theme Icon: Gold Moon -->
                    <i class="fa-solid fa-moon text-lg text-gold hidden dark:block group-hover:text-white transition-colors"></i>
                </button>
            </div>

            <!-- Form -->
            <div class="p-8 space-y-6 flex-1">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Password -->
                    <div class="col-span-1 md:col-span-2">
                        <label class="block text-[10px] font-bold uppercase text-gray-500 tracking-wider mb-2 ml-1">Access Password</label>
                        <div class="input-group rounded-lg px-4 py-3 flex items-center">
                            <i class="fa-solid fa-key text-gray-400 mr-3"></i>
                            <input type="text" id="passwordInput" 
                                class="bg-transparent border-none outline-none w-full text-sm font-mono placeholder-gray-400 focus:ring-0 transition-colors"
                                placeholder="e.g. Platinum2025" value="Platinum2025">
                        </div>
                    </div>

                    <!-- Target URL -->
                    <div class="col-span-1 md:col-span-2">
                        <label class="block text-[10px] font-bold uppercase text-gray-500 tracking-wider mb-2 ml-1">Target Destination</label>
                        <div class="input-group rounded-lg px-4 py-3 flex items-center">
                            <i class="fa-solid fa-link text-gray-400 mr-3"></i>
                            <input type="text" id="urlInput" 
                                class="bg-transparent border-none outline-none w-full text-sm font-mono placeholder-gray-400 focus:ring-0 transition-colors"
                                placeholder="https://..." value="https://aiartisan.hqaim.com/modules/premium-hub-555.html">
                        </div>
                        <p class="text-[10px] text-gray-500 mt-2 ml-1"><i class="fa-solid fa-circle-info mr-1"></i> This is the hidden file users will be redirected to.</p>
                    </div>

                    <!-- Expiry -->
                    <div>
                        <label class="block text-[10px] font-bold uppercase text-gray-500 tracking-wider mb-2 ml-1">Access Duration</label>
                        <div class="input-group rounded-lg px-4 py-3 flex items-center relative">
                            <i class="fa-solid fa-hourglass-half text-gray-400 mr-3"></i>
                            <select id="expiryInput" class="bg-transparent border-none outline-none w-full text-sm font-mono appearance-none focus:ring-0 cursor-pointer relative z-10 transition-colors">
                                <option value="lifetime" class="bg-gray-50 dark:bg-gray-900" selected>Lifetime Access</option>
                                <option value="24" class="bg-gray-50 dark:bg-gray-900">24 Hours</option>
                                <option value="168" class="bg-gray-50 dark:bg-gray-900">7 Days</option>
                                <option value="720" class="bg-gray-50 dark:bg-gray-900">30 Days</option>
                            </select>
                            <i class="fa-solid fa-chevron-down absolute right-4 text-gray-400 pointer-events-none"></i>
                        </div>
                    </div>

                    <!-- Security -->
                    <div>
                        <label class="block text-[10px] font-bold uppercase text-gray-500 tracking-wider mb-2 ml-1">Algorithm</label>
                        <div class="input-group rounded-lg px-4 py-3 flex items-center opacity-60 cursor-not-allowed bg-gray-50 dark:bg-white/5">
                            <i class="fa-solid fa-lock text-gray-400 mr-3"></i>
                            <span class="text-sm font-mono text-gray-500 dark:text-gray-400">AES-GCM (Fixed)</span>
                        </div>
                    </div>
                </div>

                <button onclick="generateLock()" class="w-full py-4 bg-gray-900 hover:bg-black dark:bg-gradient-to-r dark:from-gold dark:to-gold-dim dark:hover:brightness-110 text-white dark:text-black font-bold rounded-lg shadow-lg transition-all transform active:scale-[0.98] flex items-center justify-center gap-2 mt-4">
                    <i class="fa-solid fa-gears dark:text-black text-gold"></i> GENERATE SECURE CONFIG
                </button>
            </div>
        </div>

        <!-- 2. Output & Workflow (Stacked Below) -->
        <div class="flex flex-col gap-6">
            
            <!-- Output Box -->
            <div class="glass-panel rounded-2xl p-6 flex-1 flex flex-col transition-all duration-500">
                <div class="flex justify-between items-end mb-3">
                    <label class="text-[10px] font-bold uppercase text-gray-500 tracking-wider">Generated Code</label>
                </div>
                <div class="relative flex-1">
                    <!-- Code Area: Enhanced Dark Mode visibility (bg-black, stronger border, shadow) -->
                    <textarea id="output" readonly 
                        class="w-full h-48 bg-gray-50 dark:bg-black text-gray-800 dark:text-green-400 font-mono text-[10px] p-4 rounded-lg border border-gray-200 dark:border-white/20 focus:outline-none resize-none leading-relaxed shadow-inner dark:shadow-[inset_0_2px_10px_rgba(0,0,0,0.5)] transition-colors duration-500"
                        placeholder="// Config code will appear here..."></textarea>
                    
                    <!-- Enhanced Copy Button -->
                    <button id="copyBtn" onclick="copyToClipboard()" class="absolute top-3 right-3 flex items-center gap-2 bg-white hover:bg-gray-50 dark:bg-white/10 dark:hover:bg-white/20 text-gray-700 dark:text-white px-3 py-1.5 rounded-md text-xs font-bold transition-all duration-200 border border-gray-200 dark:border-white/10 shadow-sm backdrop-blur-md group">
                        <i class="fa-regular fa-copy"></i>
                        <span>Copy</span>
                    </button>
                </div>
                <p class="text-[10px] text-gray-500 mt-3 text-center leading-relaxed">
                    Paste this code block into the script section of <strong class="text-gray-800 dark:text-gray-300">gateway-premium-access.html</strong>.
                </p>
            </div>

            <!-- Quick Guide -->
            <div class="glass-panel rounded-2xl p-6 transition-all duration-500">
                <h3 class="text-xs font-bold text-gray-800 dark:text-white uppercase tracking-wider mb-4 border-b border-gray-200 dark:border-white/5 pb-2">
                    <i class="fa-solid fa-list-check text-gold mr-2"></i> Workflow
                </h3>
                <ul class="space-y-3">
                    <li class="flex gap-3 items-start">
                        <span class="w-5 h-5 rounded-full bg-gray-200 dark:bg-white/5 flex items-center justify-center text-[10px] font-mono text-gray-600 dark:text-gray-400 shrink-0 border border-gray-300 dark:border-white/5">1</span>
                        <p class="text-xs text-gray-500 dark:text-gray-400">Set the <span class="font-bold text-gray-800 dark:text-white">Password</span> your users will type.</p>
                    </li>
                    <li class="flex gap-3 items-start">
                        <span class="w-5 h-5 rounded-full bg-gray-200 dark:bg-white/5 flex items-center justify-center text-[10px] font-mono text-gray-600 dark:text-gray-400 shrink-0 border border-gray-300 dark:border-white/5">2</span>
                        <p class="text-xs text-gray-500 dark:text-gray-400">Ensure <span class="font-bold text-gray-800 dark:text-white">Target URL</span> points to your hidden hub file.</p>
                    </li>
                    <li class="flex gap-3 items-start">
                        <span class="w-5 h-5 rounded-full bg-gray-200 dark:bg-white/5 flex items-center justify-center text-[10px] font-mono text-gray-600 dark:text-gray-400 shrink-0 border border-gray-300 dark:border-white/5">3</span>
                        <p class="text-xs text-gray-500 dark:text-gray-400">Generate & Copy the code block.</p>
                    </li>
                    <li class="flex gap-3 items-start">
                        <span class="w-5 h-5 rounded-full bg-gray-200 dark:bg-white/5 flex items-center justify-center text-[10px] font-mono text-gray-600 dark:text-gray-400 shrink-0 border border-gray-300 dark:border-white/5">4</span>
                        <p class="text-xs text-gray-500 dark:text-gray-400">Paste it into the Gateway file to lock the door.</p>
                    </li>
                </ul>
            </div>

        </div>
    </div>

    <script>
        // --- Theme Logic ---
        function toggleTheme() {
            const html = document.documentElement;
            if (html.classList.contains('dark')) {
                html.classList.remove('dark');
                html.classList.add('light');
                localStorage.setItem('adminTheme', 'light');
            } else {
                html.classList.remove('light');
                html.classList.add('dark');
                localStorage.setItem('adminTheme', 'dark');
            }
        }

        // Init Theme
        (function() {
            const savedTheme = localStorage.getItem('adminTheme') || 'dark';
            document.documentElement.className = savedTheme;
        })();

        // --- Lock Logic ---
        async function generateLock() {
            const password = document.getElementById('passwordInput').value;
            const url = document.getElementById('urlInput').value;
            const expiryOption = document.getElementById('expiryInput').value;
            const output = document.getElementById('output');

            if (!password || !url) {
                alert("Please enter both a Password and a Target URL.");
                return;
            }

            // Simple URL Validation
            if (!url.startsWith('http')) {
                alert("Target URL must start with http:// or https://");
                return;
            }

            try {
                output.value = "// Encrypting...";
                
                // 1. Calculate Expiry Timestamp
                let expiryTimestamp = null;
                if (expiryOption !== 'lifetime') {
                    const hours = parseInt(expiryOption);
                    const now = Date.now();
                    expiryTimestamp = now + (hours * 60 * 60 * 1000); 
                }

                // 2. Create Payload Object
                const payload = {
                    url: url,
                    expiry: expiryTimestamp,
                    generatedAt: Date.now()
                };

                const payloadString = JSON.stringify(payload);
                const enc = new TextEncoder();
                
                // 3. Generate Random Salt and IV
                const salt = window.crypto.getRandomValues(new Uint8Array(16));
                const iv = window.crypto.getRandomValues(new Uint8Array(12));

                // 4. Derive Key from Password
                const keyMaterial = await window.crypto.subtle.importKey(
                    "raw", enc.encode(password), { name: "PBKDF2" }, false, ["deriveKey"]
                );

                const key = await window.crypto.subtle.deriveKey(
                    { name: "PBKDF2", salt: salt, iterations: 100000, hash: "SHA-256" },
                    keyMaterial, { name: "AES-GCM", length: 256 }, false, ["encrypt"]
                );

                // 5. Encrypt the Payload String
                const encryptedContent = await window.crypto.subtle.encrypt(
                    { name: "AES-GCM", iv: iv }, key, enc.encode(payloadString)
                );

                // 6. Convert to Base64 strings
                const toBase64 = (buffer) => {
                    let binary = '';
                    const bytes = new Uint8Array(buffer);
                    const len = bytes.byteLength;
                    for (let i = 0; i < len; i++) {
                        binary += String.fromCharCode(bytes[i]);
                    }
                    return window.btoa(binary);
                };

                const config = {
                    salt: toBase64(salt),
                    iv: toBase64(iv),
                    ciphertext: toBase64(encryptedContent)
                };

                // 7. Format Output
                const jsonString = JSON.stringify(config, null, 2);
                const finalCode = `// Generated for: ${password} \nconst lockConfig = ${jsonString};`;
                
                output.value = finalCode;

            } catch (err) {
                console.error(err);
                output.value = "Error: " + err.message;
            }
        }

        // Robust Copy Function with Interactive Button
        function copyToClipboard() {
            const output = document.getElementById("output");
            const btn = document.getElementById("copyBtn");
            if(!output.value) return;
            
            output.select();
            output.setSelectionRange(0, 99999);
            
            // Check for Clipboard API availability and context security
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(output.value)
                    .then(() => showBtnSuccess(btn))
                    .catch(err => {
                        console.warn("Clipboard API failed, using fallback", err);
                        fallbackCopy(btn);
                    });
            } else {
                fallbackCopy(btn);
            }
        }

        function fallbackCopy(btn) {
            try {
                document.execCommand('copy');
                showBtnSuccess(btn);
            } catch (err) {
                console.error("Fallback copy failed", err);
                alert("Copy failed. Please select the text and copy manually.");
            }
        }

        function showBtnSuccess(btn) {
            // Save original HTML
            const originalHTML = '<i class="fa-regular fa-copy"></i><span>Copy</span>';
            
            // Change to success state
            btn.innerHTML = '<i class="fa-solid fa-check"></i><span>Copied!</span>';
            
            // Force Success Style Override
            btn.classList.remove('bg-white', 'hover:bg-gray-50', 'dark:bg-white/10', 'dark:hover:bg-white/20', 'text-gray-700', 'dark:text-white', 'border-gray-200', 'dark:border-white/10');
            btn.classList.add('bg-green-500', 'text-white', 'border-green-500', 'hover:bg-green-600');
            
            setTimeout(() => {
                // Revert Content
                btn.innerHTML = originalHTML;
                
                // Remove Success Styles
                btn.classList.remove('bg-green-500', 'text-white', 'border-green-500', 'hover:bg-green-600');
                
                // Restore Original Styles
                btn.classList.add('bg-white', 'hover:bg-gray-50', 'dark:bg-white/10', 'dark:hover:bg-white/20', 'text-gray-700', 'dark:text-white', 'border-gray-200', 'dark:border-white/10');
            }, 2000);
        }
    </script>
</body>
</html>
