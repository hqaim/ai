<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Admin | Lock Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@400;600&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        obsidian: '#0f172a',
                        gold: '#d4af37',
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    }
                }
            }
        }
    </script>
    <style>
        body { background-color: #f3f4f6; color: #1f2937; }
        .input-group { transition: all 0.2s; }
        .input-group:focus-within { border-color: #d4af37; box-shadow: 0 0 0 2px rgba(212, 175, 55, 0.1); }
    </style>
</head>
<body class="h-screen flex flex-col items-center justify-center bg-gray-100 font-sans p-4">

    <div class="max-w-2xl w-full bg-white rounded-xl shadow-2xl overflow-hidden border border-gray-200 flex flex-col max-h-[95vh]">
        
        <!-- Header -->
        <div class="bg-gray-900 text-white p-6 flex items-center justify-between shrink-0">
            <div>
                <h1 class="text-xl font-bold tracking-tight font-mono">LOCK_MAKER_V2.1</h1>
                <p class="text-xs text-gray-400 mt-1">AES-GCM Encryption + Time Lock Utility</p>
            </div>
            <div class="w-10 h-10 rounded bg-white/10 flex items-center justify-center text-green-400">
                <i class="fa-solid fa-shield-halved text-xl"></i>
            </div>
        </div>

        <!-- Content -->
        <div class="p-8 space-y-6 overflow-y-auto">
            
            <!-- Inputs -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Password Input -->
                <div class="col-span-1 md:col-span-2">
                    <label class="block text-xs font-bold uppercase text-gray-500 mb-2">Access Password</label>
                    <div class="input-group flex items-center border border-gray-300 rounded-lg bg-gray-50 px-3 py-3">
                        <i class="fa-solid fa-key text-gray-400 mr-3"></i>
                        <input type="text" id="passwordInput" 
                            class="bg-transparent border-none outline-none w-full text-sm font-mono text-gray-900 placeholder-gray-400"
                            placeholder="e.g. PlatinumAccess2025" value="PlatinumAccess2025">
                    </div>
                </div>

                <!-- URL Input -->
                <div class="col-span-1 md:col-span-2">
                    <label class="block text-xs font-bold uppercase text-gray-500 mb-2">Target Destination</label>
                    <div class="input-group flex items-center border border-gray-300 rounded-lg bg-gray-50 px-3 py-3">
                        <i class="fa-solid fa-link text-gray-400 mr-3"></i>
                        <input type="text" id="urlInput" 
                            class="bg-transparent border-none outline-none w-full text-sm font-mono text-gray-900 placeholder-gray-400"
                            placeholder="https://aiartisan.hqaim.com/modules/a786z-premium-hub.html" value="https://aiartisan.hqaim.com/modules/premium-hub-a786z.html">
                    </div>
                    <p class="text-[10px] text-gray-400 mt-1 ml-1">Tip: Use the full URL (https://...) for maximum reliability.</p>
                </div>

                <!-- Expiry Input -->
                <div>
                    <label class="block text-xs font-bold uppercase text-gray-500 mb-2">Access Duration</label>
                    <div class="input-group flex items-center border border-gray-300 rounded-lg bg-gray-50 px-3 py-3">
                        <i class="fa-solid fa-hourglass-half text-gray-400 mr-3"></i>
                        <select id="expiryInput" class="bg-transparent border-none outline-none w-full text-sm font-mono text-gray-900">
                            <option value="lifetime" selected>Lifetime Access</option>
                            <option value="24">24 Hours</option>
                            <option value="168">7 Days</option>
                            <option value="720">30 Days</option>
                            <option value="1">TEST (1 Hour)</option>
                        </select>
                    </div>
                </div>

                <!-- Security Level (Cosmetic for this version, defaults to High) -->
                <div>
                    <label class="block text-xs font-bold uppercase text-gray-500 mb-2">Encryption Standard</label>
                    <div class="input-group flex items-center border border-gray-300 rounded-lg bg-gray-100 px-3 py-3 opacity-70 cursor-not-allowed">
                        <i class="fa-solid fa-lock text-gray-400 mr-3"></i>
                        <span class="text-sm font-mono text-gray-500">AES-GCM-256 (Fixed)</span>
                    </div>
                </div>
            </div>

            <!-- Action -->
            <button onclick="generateLock()" class="w-full bg-gray-900 hover:bg-black text-white font-bold py-4 rounded-lg shadow-lg transform transition active:scale-[0.98] flex items-center justify-center gap-2">
                <i class="fa-solid fa-gears text-gold"></i>
                <span>GENERATE ENCRYPTED LOCK</span>
            </button>

            <!-- Output -->
            <div>
                <div class="flex justify-between items-end mb-2">
                    <label class="block text-xs font-bold uppercase text-gray-500">Generated Configuration</label>
                    <span id="copyStatus" class="text-xs font-bold text-green-600 opacity-0 transition-opacity">Copied!</span>
                </div>
                <div class="relative">
                    <textarea id="output" readonly 
                        class="w-full h-32 bg-gray-800 text-green-400 font-mono text-xs p-4 rounded-lg border border-gray-700 focus:outline-none resize-none leading-relaxed"
                        placeholder="// Output will appear here..."></textarea>
                    <button onclick="copyToClipboard()" class="absolute top-2 right-2 bg-gray-700 hover:bg-gray-600 text-white p-2 rounded text-xs transition-colors" title="Copy Code">
                        <i class="fa-regular fa-copy"></i> Copy
                    </button>
                </div>
                <p class="text-[10px] text-gray-400 mt-2 text-center">
                    Paste this entire code block into the <code>&lt;script&gt;</code> section of <strong>premium-access.html</strong>.
                </p>
            </div>

        </div>
    </div>

    <script>
        async function generateLock() {
            const password = document.getElementById('passwordInput').value;
            const url = document.getElementById('urlInput').value;
            const expiryOption = document.getElementById('expiryInput').value;
            const output = document.getElementById('output');

            if (!password || !url) {
                alert("Please enter both a Password and a Target URL.");
                return;
            }

            try {
                output.value = "Encrypting...";
                
                // 1. Calculate Expiry Timestamp
                let expiryTimestamp = null;
                if (expiryOption !== 'lifetime') {
                    const hours = parseInt(expiryOption);
                    const now = Date.now();
                    // Add hours to current time
                    expiryTimestamp = now + (hours * 60 * 60 * 1000); 
                }

                // 2. Create Payload Object
                const payload = {
                    url: url,
                    expiry: expiryTimestamp,
                    generatedAt: Date.now()
                };

                const payloadString = JSON.stringify(payload);
                const enc = new TextEncoder();
                
                // 3. Generate Random Salt and IV
                const salt = window.crypto.getRandomValues(new Uint8Array(16));
                const iv = window.crypto.getRandomValues(new Uint8Array(12));

                // 4. Derive Key from Password
                const keyMaterial = await window.crypto.subtle.importKey(
                    "raw", enc.encode(password), { name: "PBKDF2" }, false, ["deriveKey"]
                );

                const key = await window.crypto.subtle.deriveKey(
                    { name: "PBKDF2", salt: salt, iterations: 100000, hash: "SHA-256" },
                    keyMaterial, { name: "AES-GCM", length: 256 }, false, ["encrypt"]
                );

                // 5. Encrypt the Payload String
                const encryptedContent = await window.crypto.subtle.encrypt(
                    { name: "AES-GCM", iv: iv }, key, enc.encode(payloadString)
                );

                // 6. Convert to Base64 strings
                const toBase64 = (buffer) => {
                    let binary = '';
                    const bytes = new Uint8Array(buffer);
                    const len = bytes.byteLength;
                    for (let i = 0; i < len; i++) {
                        binary += String.fromCharCode(bytes[i]);
                    }
                    return window.btoa(binary);
                };

                const config = {
                    salt: toBase64(salt),
                    iv: toBase64(iv),
                    ciphertext: toBase64(encryptedContent)
                };

                // 7. Format Output
                const jsonString = JSON.stringify(config, null, 2);
                const finalCode = `const lockConfig = ${jsonString};`;
                
                output.value = finalCode;

            } catch (err) {
                console.error(err);
                output.value = "Error: " + err.message;
            }
        }

        function copyToClipboard() {
            const output = document.getElementById("output");
            if(!output.value) return;
            
            output.select();
            output.setSelectionRange(0, 99999);
            
            if (navigator.clipboard) {
                navigator.clipboard.writeText(output.value).then(showSuccess);
            } else {
                document.execCommand('copy');
                showSuccess();
            }
        }

        function showSuccess() {
            const status = document.getElementById('copyStatus');
            status.style.opacity = '1';
            setTimeout(() => { status.style.opacity = '0'; }, 2000);
        }
    </script>
</body>
</html>